---
const menuItems = [
  { 
    title: "Experience", 
    path: "#experience", 
    icon: `<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <rect x="2" y="3" width="20" height="14" rx="2" ry="2"/>
      <line x1="8" y1="21" x2="16" y2="21"/>
      <line x1="12" y1="17" x2="12" y2="21"/>
    </svg>`
  },
  { 
    title: "Skills", 
    path: "#skills", 
    icon: `<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <polygon points="13,2 3,14 12,14 11,22 21,10 12,10"/>
    </svg>`
  },
  { 
    title: "About me", 
    path: "#about", 
    icon: `<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
      <circle cx="12" cy="7" r="4"/>
    </svg>`
  },
  { 
    title: "Contact", 
    path: "#contact", 
    icon: `<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"><path fill="currentColor" d="M2 6a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2zm3.519 0L12 11.671L18.481 6zM20 7.329l-7.341 6.424a1 1 0 0 1-1.318 0L4 7.329V18h16z"/></svg>`
  },
];
---

<!-- Desktop Sidebar Navigation -->
<nav class="hidden lg:flex fixed left-0 top-0 h-full w-64 bg-white/95 dark:bg-gray-900/95 backdrop-blur-sm border-r border-gray-200 dark:border-gray-700 z-50 transition-all duration-300">
  <div class="flex flex-col h-full w-full">
    <div class="flex items-center justify-start h-16 px-4 border-b border-gray-200">
      <a href="#home" class="text-2xl font-bold text-blue-600">
        SalazarWeb
      </a>
    </div>

    <!-- Navigation Menu -->
    <div class="flex-1 flex flex-col justify-center">
      <ul class="space-y-2 px-3">
        {
          menuItems.map((item) => (
            <li>
              <a
                href={item.path}
                class="nav-link group flex items-center justify-start w-full px-3 py-3 text-gray-600 hover:text-blue-600 rounded-lg transition-all duration-300 relative overflow-hidden"
              >
                <span class="nav-icon flex items-center justify-center transition-all duration-300" set:html={item.icon}></span>
                <span class="nav-text ml-3 font-medium transition-all duration-300">{item.title}</span>
                <div class="nav-underline absolute bottom-0 left-1/2 w-0 h-0.5 bg-gradient-to-r from-blue-500 to-blue-600 transition-all duration-300 transform -translate-x-1/2"></div>
              </a>
            </li>
          ))
        }
      </ul>
    </div>

    <!-- Download CV Button -->
    <div class="p-4 border-t border-gray-200 dark:border-gray-700">
      <a
        href="src/assets/David_Salazar_CV.pdf"
        download
        class="download-cv-button flex items-center gap-2 px-4 py-2 rounded-full bg-blue-500 text-white transition-all duration-300 hover:scale-105 hover:shadow-lg"
      >
        <svg class="w-5 h-5 transition-transform duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
        </svg>
        <span>Download CV</span>
      </a>
    </div>
  </div>
</nav>

<!-- Mobile Bottom Navigation -->
<nav class="lg:hidden fixed bottom-0 left-0 right-0 bg-white/95 dark:bg-gray-900/95 backdrop-blur-sm border-t border-gray-200 dark:border-gray-700 z-50">
  <div class="flex items-center justify-around px-2 py-2">
    {
      menuItems.map((item) => (
        <a
          href={item.path}
          class="mobile-nav-link flex flex-col items-center justify-center p-3 text-gray-600 dark:text-gray-300 hover:text-blue-600 dark:hover:text-blue-400 transition-all duration-300 rounded-lg min-w-0 flex-1 relative overflow-hidden"
        >
          <span class="mobile-nav-icon flex items-center justify-center mb-1 transition-all duration-300" set:html={item.icon}></span>
          <span class="mobile-nav-text text-xs font-medium truncate transition-all duration-300">{item.title}</span>
          <div class="mobile-nav-underline absolute bottom-0 left-1/2 w-0 h-0.5 bg-gradient-to-r from-blue-500 to-blue-600 transition-all duration-300 transform -translate-x-1/2"></div>
        </a>
      ))
    }
    <!-- Download CV Button for Mobile -->
    <a
    href="src/assets/David_Salazar_CV.pdf"
    download
    class="mobile-nav-link flex flex-col items-center justify-center p-3 text-blue-600 hover:bg-blue-500 hover:text-gray-200 transition-all duration-300 rounded-lg min-w-0 flex-1"
  >
    <svg class="w-5 h-5 transition-transform duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
    </svg>
    <span class="text-xs">CV</span>
  </a>
  </div>
</nav>

<script>
  function setupSidebarNavigation() {
    const sections = document.querySelectorAll('section[id]');
    const navLinks = document.querySelectorAll('nav a[href^="#"]');

    function highlightActiveSection() {
      let current = '';
      
      sections.forEach(section => {
        const sectionTop = (section as HTMLElement).offsetTop;
        if (window.scrollY >= sectionTop - 100) {
          current = section.getAttribute('id') || '';
        }
      });

      // Update active navigation link with new animations
      navLinks.forEach(link => {
        const isActive = link.getAttribute('href') === `#${current}`;
        
        // Remove all active classes
        link.classList.remove('nav-active', 'mobile-nav-active');
        
        // Add active class if current
        if (isActive) {
          if (link.classList.contains('mobile-nav-link')) {
            link.classList.add('mobile-nav-active');
          } else {
            link.classList.add('nav-active');
          }
        }
      });
    }

    // Smooth scroll
    navLinks.forEach(link => {
      link.addEventListener('click', (e) => {
        e.preventDefault();
        const targetId = link.getAttribute('href')?.substring(1);
        const targetSection = document.getElementById(targetId || '');
        
        if (targetSection) {
          targetSection.scrollIntoView({
            behavior: 'smooth',
            block: 'start'
          });
        }
      });
    });

    window.addEventListener('scroll', highlightActiveSection);
    highlightActiveSection();
  }

  setupSidebarNavigation();
  document.addEventListener('astro:page-load', setupSidebarNavigation);
</script>

<style>
  /* Desktop Navigation Active State */
  .nav-active {
    @apply text-blue-600 dark:text-blue-400;
  }

  .nav-active .nav-icon {
    transform: scale(1.15);
    filter: brightness(1.3) drop-shadow(0 0 8px rgba(59, 130, 246, 0.4));
  }

  .nav-active .nav-text {
    transform: scale(1.1);
    font-weight: 600;
    filter: brightness(1.1);
    text-shadow: 0 0 10px rgba(59, 130, 246, 0.3);
  }

  .nav-active .nav-underline {
    width: 80%;
    height: 3px;
    box-shadow: 0 0 8px rgba(59, 130, 246, 0.6);
    animation: underlineGlow 2s ease-in-out infinite alternate;
  }

  /* Mobile Navigation Active State */
  .mobile-nav-active {
    @apply text-blue-600 dark:text-blue-400;
  }

  .mobile-nav-active .mobile-nav-icon {
    transform: scale(1.2);
    filter: brightness(1.3) drop-shadow(0 0 6px rgba(59, 130, 246, 0.4));
  }

  .mobile-nav-active .mobile-nav-text {
    transform: scale(1.15);
    font-weight: 600;
    filter: brightness(1.2);
    text-shadow: 0 0 8px rgba(59, 130, 246, 0.3);
  }

  .mobile-nav-active .mobile-nav-underline {
    width: 70%;
    height: 2px;
    box-shadow: 0 0 6px rgba(59, 130, 246, 0.6);
    animation: underlineGlow 2s ease-in-out infinite alternate;
  }

  /* Underline Glow Animation */
  @keyframes underlineGlow {
    0% {
      box-shadow: 0 0 8px rgba(59, 130, 246, 0.6);
      filter: brightness(1);
    }
    100% {
      box-shadow: 0 0 12px rgba(59, 130, 246, 0.9);
      filter: brightness(1.2);
    }
  }

  /* Hover Effects */
  .nav-link:hover .nav-icon {
    transform: scale(1.1);
    filter: brightness(1.2);
  }

  .nav-link:hover .nav-text {
    transform: scale(1.02);
  }

  .nav-link:hover .nav-underline {
    width: 60%;
    height: 2px;
  }

  .mobile-nav-link:hover .mobile-nav-icon {
    transform: scale(1.15);
    filter: brightness(1.2);
  }

  .mobile-nav-link:hover .mobile-nav-text {
    transform: scale(1.02);
  }

  .mobile-nav-link:hover .mobile-nav-underline {
    width: 50%;
    height: 2px;
  }

  /* Download CV Button Animations */
  .download-cv-button {
    box-shadow: 0 4px 6px rgba(59, 130, 246, 0.25);
    font-weight: 600;
    position: relative;
    overflow: hidden;
  }

  .download-cv-button::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(255, 255, 255, 0.1);
    transform: translateX(-100%) skewX(-15deg);
    transition: transform 0.4s ease;
  }

  .download-cv-button:hover::before {
    transform: translateX(100%) skewX(-15deg);
  }

  .download-cv-button:hover svg {
    transform: scale(1.2);
  }

  .download-cv-button:active {
    transform: translateY(2px) scale(0.98);
    box-shadow: 0 2px 3px rgba(59, 130, 246, 0.2);
  }
</style>